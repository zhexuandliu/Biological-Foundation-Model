anova_model <- aov(as.numeric(bract_angle) ~ individial_id, data = floral_morpho, na.action = na.omit)
summary(anova_model)
anova_model <- aov(as.numeric(bract_angle) ~ clade+species+pop_ID+individial_id, data = floral_morpho, na.action = na.omit)
summary(anova_model)
var_ratio_mat = c()
library(lme4)
model_inflorescence_angle <- lmer(as.numeric(inflorescence_angle) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_inflorescence_angle)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_bract_angle <- lmer(as.numeric(bract_angle) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_bract_angle)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_flowers_per_inflorescence <- lmer(as.numeric(flowers_per_inflorescence) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_flowers_per_inflorescence)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_bract_length <- lmer(as.numeric(bract_length) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_bract_length)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_bract_width <- lmer(as.numeric(bract_width) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_bract_width)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_petal_length <- lmer(as.numeric(petal_length) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_petal_length)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_petal_width <- lmer(as.numeric(petal_width) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_petal_width)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_stamen_length <- lmer(as.numeric(stamen_length) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_stamen_length)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_style_length <- lmer(as.numeric(style_length) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_style_length)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_stigmatic_hair_length <- lmer(as.numeric(stigmatic_hair_length) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_stigmatic_hair_length)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
rownames(var_ratio_mat) = c("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
colnames(var_ratio_mat) = c("clade", "species", "population", "individual")
print(var_ratio_mat)
p_clade_bract_angle = ggplot(floral_morpho, aes(x = clade, y = as.numeric(bract_angle))) +
geom_boxplot() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ggtitle("Boxplot of bract angle by clade")
plot(p_clade_bract_angle)
p_species_bract_angle = ggplot(floral_morpho, aes(x = species, y = as.numeric(bract_angle))) +
geom_boxplot() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ggtitle("Boxplot of bract angle by species")
plot(p_species_bract_angle)
p_population_bract_angle = ggplot(floral_morpho, aes(x = pop_ID, y = as.numeric(bract_angle))) +
geom_boxplot() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ggtitle("Boxplot of bract angle by population")
plot(p_population_bract_angle)
# ("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
year_vec = as.factor(format(floral_morpho$`COLLECTED_ON (herbarium)`, "%Y"))
t.test(floral_morpho$inflorescence_angle ~ year_vec, subset = !is.na(year_vec))
year_vec
# ("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
year_vec = as.factor(format(floral_morpho$`COLLECTED_ON (herbarium)`, "%Y"))
t.test(floral_morpho$inflorescence_angle[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
floral_morpho$inflorescence_angle[!is.na(year_vec)]
# ("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
year_vec = as.factor(format(floral_morpho$`COLLECTED_ON (herbarium)`, "%Y"))
t.test(as.numeriv(floral_morpho$inflorescence_angle)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
# ("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
year_vec = as.factor(format(floral_morpho$`COLLECTED_ON (herbarium)`, "%Y"))
t.test(as.numeric(floral_morpho$inflorescence_angle)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
# ("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
year_vec = as.factor(format(floral_morpho$`COLLECTED_ON (herbarium)`, "%Y"))
t.test(as.numeric(floral_morpho$inflorescence_angle)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$bract_angle)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$flowers_per_inflorescence)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$bract_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$bract_width)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$petal_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$petal_width)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$stamen_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$style_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$stigmatic_hair_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
test_result = t.test(as.numeric(floral_morpho$inflorescence_angle)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
test_result$p.value
test_result$statistic
mean(as.numeric(floral_morpho$inflorescence_angle)[floral_morpho$inflorescence_angle=="2022"])
as.numeric(floral_morpho$inflorescence_angle)[floral_morpho$inflorescence_angle=="2022"]
mean(as.numeric(floral_morpho$inflorescence_angle)[year_vec=="2022"])
mean(as.numeric(floral_morpho$inflorescence_angle)[year_vec=="2022"])
?mean
mean(as.numeric(floral_morpho$inflorescence_angle)[year_vec=="2022"], na.rm = FALSE)
# ("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
year_vec = as.factor(format(floral_morpho$`COLLECTED_ON (herbarium)`, "%Y"))
test_result = t.test(as.numeric(floral_morpho$inflorescence_angle)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$bract_angle)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$flowers_per_inflorescence)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$bract_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$bract_width)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$petal_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$petal_width)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$stamen_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$style_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t.test(as.numeric(floral_morpho$stigmatic_hair_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
test_result = t.test(as.numeric(floral_morpho$inflorescence_angle)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
test_result$estimate
# ("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
year_vec = as.factor(format(floral_morpho$`COLLECTED_ON (herbarium)`, "%Y"))
t_test_result = c()
test_result = t.test(as.numeric(floral_morpho$inflorescence_angle)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$bract_angle)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$flowers_per_inflorescence)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$bract_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$bract_width)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$petal_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$petal_width)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$stamen_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$style_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$stigmatic_hair_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
t_test_result
test_result$parameter
as.numeric(floral_morpho$inflorescence_angle)[!is.na(year_vec)]
print(rbind(floral_morpho$inflorescence_angle)[!is.na(year_vec)], year_vec[!is.na(year_vec)]))
print(rbind(as.numeric(floral_morpho$inflorescence_angle)[!is.na(year_vec)], year_vec[!is.na(year_vec)]))
# ("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
year_vec = as.factor(format(floral_morpho$`COLLECTED_ON (herbarium)`, "%Y"))
t_test_result = c()
test_result = t.test(as.numeric(floral_morpho$inflorescence_angle)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$bract_angle)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$flowers_per_inflorescence)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$bract_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$bract_width)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$petal_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$petal_width)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$stamen_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$style_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$stigmatic_hair_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
rownames(t_test_result) = c("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
print(t_test_result)
# ("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
year_vec = as.factor(format(floral_morpho$`COLLECTED_ON (herbarium)`, "%Y"))
t_test_result = c()
test_result = t.test(as.numeric(floral_morpho$inflorescence_angle)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$bract_angle)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$flowers_per_inflorescence)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$bract_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$bract_width)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$petal_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$petal_width)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$stamen_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$style_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
test_result = t.test(as.numeric(floral_morpho$stigmatic_hair_length)[!is.na(year_vec)] ~ year_vec[!is.na(year_vec)])
t_test_result = rbind(t_test_result, c(test_result$estimate, test_result$p.value))
rownames(t_test_result) = c("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
colnames(t_test_result) = c('2022', '2023', "p-value")
print(t_test_result)
floral_morpho["year"] = year_vec
?lmer
getOption("na.action")
floral_morpho["year"] = year_vec
var_ratio_mat = c()
library(lme4)
model_inflorescence_angle <- lmer(as.numeric(inflorescence_angle) ~ 1 + (1 | clade/species/pop_ID/individial_id) + year, data = floral_morpho, na.action = na.omit)
model_inflorescence_angle <- lmer(as.numeric(inflorescence_angle) ~ (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
model_inflorescence_angle
model_inflorescence_angle <- lmer(as.numeric(inflorescence_angle) ~ (1 | clade/species/pop_ID/individial_id) + year, data = floral_morpho, na.action = na.omit)
print(var_ratio_mat)
var_ratio_mat = c()
library(lme4)
model_inflorescence_angle <- lmer(as.numeric(inflorescence_angle) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_inflorescence_angle)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_bract_angle <- lmer(as.numeric(bract_angle) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_bract_angle)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_flowers_per_inflorescence <- lmer(as.numeric(flowers_per_inflorescence) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_flowers_per_inflorescence)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_bract_length <- lmer(as.numeric(bract_length) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_bract_length)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_bract_width <- lmer(as.numeric(bract_width) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_bract_width)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_petal_length <- lmer(as.numeric(petal_length) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_petal_length)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_petal_width <- lmer(as.numeric(petal_width) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_petal_width)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_stamen_length <- lmer(as.numeric(stamen_length) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_stamen_length)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_style_length <- lmer(as.numeric(style_length) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_style_length)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
model_stigmatic_hair_length <- lmer(as.numeric(stigmatic_hair_length) ~ 1 + (1 | clade/species/pop_ID/individial_id), data = floral_morpho)
sum = summary(model_stigmatic_hair_length)
var_est = c(sum$varcor$clade[1], sum$varcor$`species:clade`[1], sum$varcor$`pop_ID:species:clade`[1], sum$varcor$`individial_id:pop_ID:species:clade`[1])
var_ratio = var_est / max(var_est)
var_ratio_mat = rbind(var_ratio_mat, var_ratio)
rownames(var_ratio_mat) = c("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
colnames(var_ratio_mat) = c("clade", "species", "population", "individual")
print(var_ratio_mat)
model_inflorescence_angle <- lmer(as.numeric(inflorescence_angle) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho, na.action = na.omit)
sum = summary(model_inflorescence_angle)
sum$coefficients
sum$coefficients[2,]
floral_morpho["year"] = year_vec
year_effect_mat = c()
library(lme4)
model_inflorescence_angle <- lmer(as.numeric(inflorescence_angle) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho, na.action = na.omit)
sum = summary(model_inflorescence_angle)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_bract_angle <- lmer(as.numeric(bract_angle) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_bract_angle)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_flowers_per_inflorescence <- lmer(as.numeric(flowers_per_inflorescence) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_flowers_per_inflorescence)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_bract_length <- lmer(as.numeric(bract_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_bract_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_bract_width <- lmer(as.numeric(bract_width) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_bract_width)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_petal_length <- lmer(as.numeric(petal_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_petal_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_petal_width <- lmer(as.numeric(petal_width) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_petal_width)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_stamen_length <- lmer(as.numeric(stamen_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_stamen_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_style_length <- lmer(as.numeric(style_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_style_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_stigmatic_hair_length <- lmer(as.numeric(stigmatic_hair_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_stigmatic_hair_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
rownames(var_ratio_mat) = c("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
# colnames(var_ratio_mat) = c("clade", "species", "population", "individual")
print(year_effect_mat)
sum
floral_morpho["year"] = year_vec
year_effect_mat = c()
library(lmerTest)
model_inflorescence_angle <- lmer(as.numeric(inflorescence_angle) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho, na.action = na.omit)
sum = summary(model_inflorescence_angle)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_bract_angle <- lmer(as.numeric(bract_angle) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_bract_angle)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_flowers_per_inflorescence <- lmer(as.numeric(flowers_per_inflorescence) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_flowers_per_inflorescence)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_bract_length <- lmer(as.numeric(bract_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_bract_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_bract_width <- lmer(as.numeric(bract_width) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_bract_width)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_petal_length <- lmer(as.numeric(petal_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_petal_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_petal_width <- lmer(as.numeric(petal_width) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_petal_width)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_stamen_length <- lmer(as.numeric(stamen_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_stamen_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_style_length <- lmer(as.numeric(style_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_style_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_stigmatic_hair_length <- lmer(as.numeric(stigmatic_hair_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_stigmatic_hair_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
rownames(var_ratio_mat) = c("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
# colnames(var_ratio_mat) = c("clade", "species", "population", "individual")
print(year_effect_mat)
floral_morpho["year"] = year_vec
year_effect_mat = c()
library(lmerTest)
model_inflorescence_angle <- lmer(as.numeric(inflorescence_angle) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho, na.action = na.omit)
sum = summary(model_inflorescence_angle)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_bract_angle <- lmer(as.numeric(bract_angle) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_bract_angle)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_flowers_per_inflorescence <- lmer(as.numeric(flowers_per_inflorescence) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_flowers_per_inflorescence)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_bract_length <- lmer(as.numeric(bract_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_bract_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_bract_width <- lmer(as.numeric(bract_width) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_bract_width)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_petal_length <- lmer(as.numeric(petal_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_petal_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_petal_width <- lmer(as.numeric(petal_width) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_petal_width)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_stamen_length <- lmer(as.numeric(stamen_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_stamen_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_style_length <- lmer(as.numeric(style_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_style_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_stigmatic_hair_length <- lmer(as.numeric(stigmatic_hair_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_stigmatic_hair_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
rownames(var_ratio_mat) = c("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
# colnames(var_ratio_mat) = c("clade", "species", "population", "individual")
print(year_effect_mat)
floral_morpho["year"] = year_vec
year_effect_mat = c()
library(lmerTest)
model_inflorescence_angle <- lmer(as.numeric(inflorescence_angle) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho, na.action = na.omit)
sum = summary(model_inflorescence_angle)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_bract_angle <- lmer(as.numeric(bract_angle) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_bract_angle)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_flowers_per_inflorescence <- lmer(as.numeric(flowers_per_inflorescence) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_flowers_per_inflorescence)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_bract_length <- lmer(as.numeric(bract_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_bract_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_bract_width <- lmer(as.numeric(bract_width) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_bract_width)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_petal_length <- lmer(as.numeric(petal_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_petal_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_petal_width <- lmer(as.numeric(petal_width) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_petal_width)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_stamen_length <- lmer(as.numeric(stamen_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_stamen_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_style_length <- lmer(as.numeric(style_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_style_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
model_stigmatic_hair_length <- lmer(as.numeric(stigmatic_hair_length) ~ (1 | clade/species/pop_ID) + year, data = floral_morpho)
sum = summary(model_stigmatic_hair_length)
year_effect = sum$coefficients[2,]
year_effect_mat = rbind(year_effect_mat, year_effect)
rownames(var_ratio_mat) = c("inflorescence_angle", "bract_angle", "flowers_per_inflorescence", "bract_length", "bract_width", "petal_length", "petal_width", "stamen_length", "style_length", "stigmatic_hair_length")
# colnames(var_ratio_mat) = c("clade", "species", "population", "individual")
print(year_effect_mat)
print(year_effect_mat)
year_vec
table(year_vec)
128256 * 4096
knitr::opts_chunk$set(echo = TRUE)
senility = read('./data/diag-senility.csv')
senility = read.csv('./data/diag-senility.csv')
soybeandamage = read.csv('./data/diag-soybeandamage.csv')
soiladditives = read.csv('./data/diag-soiladditives.csv')
senility
knitr::opts_chunk$set(echo = TRUE)
# load perturbation score
dir = '/Users/zhexuanliu/Desktop/paper codes/case study (cifar10) version2/perturbation score/test data/len 2/'
load(paste(dir,'input_data.RData',sep = ''))
perplexity
plot(Y)
install.packages("BiocManager")
BiocManager::install("glmGamPoi")
library(SingleCellExperiment)
library(tidyverse)
library(glmGamPoi)
sce <- zellkonverter::readH5AD(file.path("../data/GEARS/perturb_processed.h5ad"))
BiocManager::install("zellkonverter")
library(SingleCellExperiment)
library(tidyverse)
library(glmGamPoi)
# Load data
folder <- "../data/GEARS/"
sce <- zellkonverter::readH5AD(file.path("../data/GEARS/perturb_processed.h5ad"))
setwd("~/Documents/GitHub/Biological-Foundation-Model/notebooks")
sce <- zellkonverter::readH5AD(file.path("../data/GEARS/perturb_processed.h5ad"))
# Clean up the colData(sce) a bit
sce$condition <- droplevels(sce$condition)
sce$clean_condition <- stringr::str_remove(sce$condition, "\\+ctrl")
gene_names <- rowData(sce)[["gene_name"]]
rownames(sce) <- gene_names
baseline <- MatrixGenerics::rowMeans2(assay(sce, "X")[,sce$condition == "ctrl",drop=FALSE])
# Pseudobulk everything
psce <- glmGamPoi::pseudobulk(sce, group_by = vars(condition, clean_condition))
assay(psce, "change") <- assay(psce, "X") - baseline
# Clean up the colData(sce) a bit
sce$condition <- droplevels(sce$condition)
sce$clean_condition <- stringr::str_remove(sce$condition, "\\+ctrl")
gene_names <- rowData(sce)[["gene_name"]]
rownames(sce) <- gene_names
baseline <- MatrixGenerics::rowMeans2(assay(sce, "X")[,sce$condition == "ctrl",drop=FALSE])
# Pseudobulk everything
psce <- glmGamPoi::pseudobulk(sce, group_by = vars(condition, clean_condition))
assay(psce, "change") <- assay(psce, "X") - baseline
pca <- irlba::prcomp_irlba(t(as.matrix(assay(psce, "X"))), n = pa$pca_dim)
pert_emb <- t(pca$x)
pca <- irlba::prcomp_irlba(t(as.matrix(assay(psce, "X"))), n = 10)
pert_emb <- t(pca$x)
colnames(pert_emb) <- psce$clean_condition
pert_emb
